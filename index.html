<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three Stage Quiz</title>
  <!-- Include SortableJS via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <style>
    body {
      font-family: sans-serif; 
      margin: 20px;
    }
    .hidden { display: none; }
    .draggable {
      display: inline-block;
      padding: 8px;
      margin: 5px;
      border: 1px solid #aaa;
      cursor: grab;
      background-color: #eee;
    }
    /* Quiz 2 and 3 boxes */
    .dropbox {
      width: 100px; 
      height: 100px; 
      border: 2px dashed #333; 
      display: inline-block; 
      vertical-align: top; 
      margin: 10px;
      background-size: cover;
      background-position: center;
    }
    /* Container for items in quiz 2 and 3 */
    .strings-container {
      border: 1px solid #ccc; 
      padding: 10px; 
      margin: 10px 0;
    }
  </style>
</head>

<body>
  <!-- Audio files -->
  <audio id="ding" src="ding.mp3"></audio>
  <audio id="tada" src="tada.mp3"></audio>

  <!-- Quiz 1 -->
  <div id="quiz1">
    <h2>Quiz 1</h2>
    <p>Drag the letters into this order: <strong>MLAMJNT</strong></p>
    <div id="lettersContainer">
      <!-- They start in alphabetical order: AJLNMMT -->
      <div class="draggable" data-value="A">A</div>
      <div class="draggable" data-value="J">J</div>
      <div class="draggable" data-value="L">L</div>
      <div class="draggable" data-value="M">M</div>
      <div class="draggable" data-value="M">M</div>
      <div class="draggable" data-value="N">N</div>
      <div class="draggable" data-value="T">T</div>
    </div>
  </div>

  <!-- Quiz 2 -->
  <div id="quiz2" class="hidden">
    <h2>Quiz 2</h2>
    <p>Drag each item into the correct box. (3 boxes)</p>
    <div style="margin-bottom:20px;">
      <div class="dropbox" id="box1" data-box="1" style="background-image:url('1.png')"></div>
      <div class="dropbox" id="box2" data-box="2" style="background-image:url('2.png')"></div>
      <div class="dropbox" id="box3" data-box="3" style="background-image:url('3.png')"></div>
    </div>

    <div id="stringsContainer2" class="strings-container">
      <!-- Example dictionary data. You can add/edit these. 
           data-correct-box="x" indicates which box is correct. -->
      <div class="draggable" data-correct-box="1">String A</div>
      <div class="draggable" data-correct-box="2">String B</div>
      <div class="draggable" data-correct-box="3">String C</div>
      <div class="draggable" data-correct-box="1">String D</div>
      <div class="draggable" data-correct-box="2">String E</div>
      <div class="draggable" data-correct-box="3">String F</div>
      <div class="draggable" data-correct-box="1">String G</div>
      <div class="draggable" data-correct-box="3">String H</div>
      <div class="draggable" data-correct-box="2">String I</div>
      <div class="draggable" data-correct-box="1">String J</div>
      <div class="draggable" data-correct-box="2">String K</div>
      <div class="draggable" data-correct-box="3">String L</div>
      <div class="draggable" data-correct-box="1">String M</div>
      <div class="draggable" data-correct-box="2">String N</div>
      <div class="draggable" data-correct-box="3">String O</div>
    </div>
  </div>

  <!-- Quiz 3 -->
  <div id="quiz3" class="hidden">
    <h2>Quiz 3</h2>
    <p>Drag each item into the correct box. (2 boxes)</p>
    <div style="margin-bottom:20px;">
      <div class="dropbox" id="box1q3" data-box="1" style="background-image:url('1.png')"></div>
      <div class="dropbox" id="box2q3" data-box="2" style="background-image:url('2.png')"></div>
    </div>

    <div id="stringsContainer3" class="strings-container">
      <!-- 16 items, data-correct-box either 1 or 2 -->
      <div class="draggable" data-correct-box="1">Item 1</div>
      <div class="draggable" data-correct-box="1">Item 2</div>
      <div class="draggable" data-correct-box="2">Item 3</div>
      <div class="draggable" data-correct-box="2">Item 4</div>
      <div class="draggable" data-correct-box="1">Item 5</div>
      <div class="draggable" data-correct-box="1">Item 6</div>
      <div class="draggable" data-correct-box="2">Item 7</div>
      <div class="draggable" data-correct-box="2">Item 8</div>
      <div class="draggable" data-correct-box="1">Item 9</div>
      <div class="draggable" data-correct-box="1">Item 10</div>
      <div class="draggable" data-correct-box="2">Item 11</div>
      <div class="draggable" data-correct-box="2">Item 12</div>
      <div class="draggable" data-correct-box="1">Item 13</div>
      <div class="draggable" data-correct-box="1">Item 14</div>
      <div class="draggable" data-correct-box="2">Item 15</div>
      <div class="draggable" data-correct-box="2">Item 16</div>
    </div>
  </div>

  <script>
    // Global references
    const quiz1 = document.getElementById('quiz1');
    const quiz2 = document.getElementById('quiz2');
    const quiz3 = document.getElementById('quiz3');
    const ding = document.getElementById('ding');
    const tada = document.getElementById('tada');

    // --- Quiz 1: Check letter order ---
    // Desired order: MLAMJNT
    const correctQuiz1Order = ['M','L','A','M','J','N','T'];
    const lettersContainer = document.getElementById('lettersContainer');

    // Make lettersContainer sortable
    const quiz1Sortable = new Sortable(lettersContainer, {
      animation: 150,
      onSort: function () {
        checkQuiz1();
      }
    });

    function checkQuiz1() {
      const items = lettersContainer.querySelectorAll('.draggable');
      let currentOrder = Array.from(items).map(i => i.dataset.value);
      if (arraysMatch(currentOrder, correctQuiz1Order)) {
        ding.play();
        setTimeout(() => {
          quiz1.classList.add('hidden');
          quiz2.classList.remove('hidden');
        }, 1000);
      }
    }

    // --- Quiz 2: 15 strings, 3 boxes ---
    // We want to check if each dragged item is in the correct box.
    const box1 = document.getElementById('box1');
    const box2 = document.getElementById('box2');
    const box3 = document.getElementById('box3');
    const stringsContainer2 = document.getElementById('stringsContainer2');

    // Create Sortable for each drop box and the container
    let quiz2Sortables = [];
    [box1, box2, box3, stringsContainer2].forEach(el => {
      quiz2Sortables.push(
        new Sortable(el, {
          group: 'quiz2',
          animation: 150,
          onSort: function () {
            checkQuiz2();
          }
        })
      );
    });

    function checkQuiz2() {
      // Check all child .draggable in each box
      let allCorrect = true;

      // Each box has data-box = "1", "2", or "3"
      [box1, box2, box3].forEach(box => {
        const boxNum = box.dataset.box; 
        const children = box.querySelectorAll('.draggable');
        children.forEach(child => {
          if (child.dataset.correctBox !== boxNum) {
            allCorrect = false;
          }
        });
      });
      // Also check that no item that belongs in box 1,2,3 got left behind in stringsContainer2
      // If you require that all must be moved out of the container to pass, we can check that too:
      // but that's optional based on your preference.

      if (allCorrect) {
        ding.play();
        setTimeout(() => {
          quiz2.classList.add('hidden');
          quiz3.classList.remove('hidden');
        }, 1000);
      }
    }

    // --- Quiz 3: 16 strings, 2 boxes ---
    const box1q3 = document.getElementById('box1q3');
    const box2q3 = document.getElementById('box2q3');
    const stringsContainer3 = document.getElementById('stringsContainer3');

    let quiz3Sortables = [];
    [box1q3, box2q3, stringsContainer3].forEach(el => {
      quiz3Sortables.push(
        new Sortable(el, {
          group: 'quiz3',
          animation: 150,
          onSort: function () {
            checkQuiz3();
          }
        })
      );
    });

    function checkQuiz3() {
      // Similar approach: box1q3.dataset.box="1", box2q3.dataset.box="2"
      let allCorrect = true;
      [box1q3, box2q3].forEach(box => {
        const boxNum = box.dataset.box;
        const children = box.querySelectorAll('.draggable');
        children.forEach(child => {
          if (child.dataset.correctBox !== boxNum) {
            allCorrect = false;
          }
        });
      });

      if (allCorrect) {
        tada.play();
        setTimeout(() => {
          // Redirect to congrats page
          window.location.href = 'congrats.html';
        }, 1000);
      }
    }

    // Utility to compare arrays
    function arraysMatch(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }
  </script>
</body>
</html>
