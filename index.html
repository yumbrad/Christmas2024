<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three Stage Quiz</title>
  <!-- Include SortableJS via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <style>
   /* Give the quizzes a parent container that can fill the page minus a bit of margin, etc. */
    body {
        margin: 20px;
        font-family: sans-serif;
        /* Optionally force full view height: 
            height: 100vh; 
            margin: 0; 
            padding: 20px; 
        */
    }

    /* Common Draggable styling */
    .draggable {
        display: inline-block;
        padding: 8px;
        margin: 5px;
        border: 1px solid #aaa;
        cursor: grab;
        background-color: #eee;
    }

    /* Hide until needed */
    .hidden {
        display: none;
    }

    /* Quiz layout: flex container, column direction
    so that .dropzone can fill leftover vertical space. */
    .quizContent {
        display: flex;
        flex-direction: column;
        /* Adjust as desired so there's enough space for everything. */
        height: 70vh;
        /* Or you can use: height: calc(100vh - 200px); */
    }

    /* The row of drop boxes: fill leftover vertical space by flex: 1 */
    .dropzone {
        display: flex;
        flex: 1;
        margin-bottom: 10px;
    }

    /* Each drop box shares these styles */
    .dropbox {
        /* Let each box grow/shrink equally; margin for spacing. */
        flex: 1;
        margin: 5px;
        /* Dashed border around the box area. */
        border: 2px dashed #333;
        /* So items stack top-down. */
        display: flex; 
        flex-direction: column;
        /* As items are placed inside, height grows. 
            We do min-height so they remain visible even if empty. */
        min-height: 100px; 
        position: relative;  /* for background overlay if needed */
        overflow-y: auto;
    }

    /* Make the background image fill the box and 50% transparent. 
    Using background-blend-mode so child elements are not faded. */
    .dropbox[data-box="1"] {
        background: 
            linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)),
            url("21p.png") center center / cover no-repeat;
        background-blend-mode: multiply;
    }

    .dropbox[data-box="2"] {
        background: 
            linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)),
            url("weeknd.png") center center / cover no-repeat;
        background-blend-mode: multiply;
    }

    .dropbox[data-box="3"] {
        background: 
            linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)),
            url("wf.png") center center / cover no-repeat;
        background-blend-mode: multiply;
    }

    .dropbox[data-box="4"] {
        background: 
            linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)),
            url("film.png") center center / cover no-repeat;
        background-blend-mode: multiply;
    }

    .dropbox[data-box="5"] {
        background: 
            linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)),
            url("ballet.jpg") center center / cover no-repeat;
        background-blend-mode: multiply;
    }

    /* Container of the items to be sorted. Let it auto-size. */
    .strings-container {
        border: 1px solid #ccc;
        padding: 10px;
        /* Optionally set a max-height if needed: 
            max-height: 150px; 
            overflow-y: auto; 
        */
    }

  </style>
</head>

<body>
  <!-- Audio files -->
  <audio id="ding" src="ding.mp3"></audio>
  <audio id="tada" src="tada.mp3"></audio>

  <!-- Quiz 1 -->
  <div id="quiz1">
    <h2>Quiz 1</h2>
    <div id="lettersContainer">
      <!-- They start in random order: AJLNMMT -->
      <div class="draggable" data-value="T">T</div>
      <div class="draggable" data-value="J">J</div>
      <div class="draggable" data-value="L">L</div>
      <div class="draggable" data-value="M">M</div>
      <div class="draggable" data-value="N">N</div>
      <div class="draggable" data-value="M">M</div>
      <div class="draggable" data-value="A">A</div>
    </div>
  </div>

  <!-- Quiz 2 -->
  <div id="quiz2" class="hidden">
    <h2>Quiz 2</h2>
    
    <!-- A flex container that fills vertical space -->
    <div class="quizContent">
        <!-- The row of drop boxes -->
        <div class="dropzone">
        <div class="dropbox" id="box1" data-box="1"></div>
        <div class="dropbox" id="box2" data-box="2"></div>
        <div class="dropbox" id="box3" data-box="3"></div>
        </div>

        <div id="stringsContainer2" class="strings-container">
        <!-- Example dictionary data. You can add/edit these. 
            data-correct-box="x" indicates which box is correct. -->
        <div class="draggable" data-correct-box="1">sometimes quiet is violent</div>
        <div class="draggable" data-correct-box="3">paint the waves with green</div>
        <div class="draggable" data-correct-box="2">I can’t feel my face</div>
        <div class="draggable" data-correct-box="2">I'm drowning in the night</div>
        <div class="draggable" data-correct-box="1">my lungs will fill and then deflate</div>
        <div class="draggable" data-correct-box="3">thunder breaks the frozen sky</div>
        <div class="draggable" data-correct-box="2">no one’s around to judge me</div>
        <div class="draggable" data-correct-box="3">the bright magnificence of day</div>
        <div class="draggable" data-correct-box="1">I’m forced to deal with what I feel</div>
        <div class="draggable" data-correct-box="3">the blessings of a peaceful reign</div>
        <div class="draggable" data-correct-box="1">all my problems are gone if I bury them deep</div>
        <div class="draggable" data-correct-box="2">I’m heartless, I’m back to my ways</div>
        <div class="draggable" data-correct-box="3">sweetly pass my careless days</div>
        <div class="draggable" data-correct-box="2">your blade it might be too sharp</div>
        <div class="draggable" data-correct-box="1">a stone's throw from a creek we used to roam</div>
        </div>
    </div>
  </div>

  <!-- Quiz 3 -->
  <div id="quiz3" class="hidden">
    <h2>Quiz 3</h2>
    <div class="quizContent">
    <div class="dropzone">
      <div class="dropbox" id="box4" data-box="4"></div>
      <div class="dropbox" id="box5" data-box="5"></div>
    </div>

    <div id="stringsContainer3" class="strings-container">
      <!-- 16 items, data-correct-box either 1 or 2 -->
      <div class="draggable" data-correct-box="2">Fourth position</div>
      <div class="draggable" data-correct-box="1">Fourth wall</div>
      <div class="draggable" data-correct-box="1">Vignette</div>
      <div class="draggable" data-correct-box="2">Arabesque</div>
      <div class="draggable" data-correct-box="2">Devant</div>
      <div class="draggable" data-correct-box="1">Montage</div>
      <div class="draggable" data-correct-box="2">Battement</div>
      <div class="draggable" data-correct-box="1">Leitmotif</div>
      <div class="draggable" data-correct-box="1">Denouement</div>
      <div class="draggable" data-correct-box="2">Cabriole</div>
      <div class="draggable" data-correct-box="1">Auteur</div>
      <div class="draggable" data-correct-box="2">Fondu</div>
      <div class="draggable" data-correct-box="2">Sissonne</div>
      <div class="draggable" data-correct-box="1">Mise-en-scene</div>
      <div class="draggable" data-correct-box="1">Juxtaposition</div>
      <div class="draggable" data-correct-box="2">Variation</div>
    </div>
    </div>
  </div>

  <script>
    // Global references
    const quiz1 = document.getElementById('quiz1');
    const quiz2 = document.getElementById('quiz2');
    const quiz3 = document.getElementById('quiz3');
    const ding = document.getElementById('ding');
    const tada = document.getElementById('tada');

    // --- Quiz 1: Check letter order ---
    // Desired order: MLAMJNT
    const correctQuiz1Order = ['M','L','A','M','J','N','T'];
    const lettersContainer = document.getElementById('lettersContainer');

    // Make lettersContainer sortable
    const quiz1Sortable = new Sortable(lettersContainer, {
      animation: 150,
      onSort: function () {
        checkQuiz1();
      }
    });

    function checkQuiz1() {
      const items = lettersContainer.querySelectorAll('.draggable');
      let currentOrder = Array.from(items).map(i => i.dataset.value);
      if (arraysMatch(currentOrder, correctQuiz1Order)) {
        ding.play();
        setTimeout(() => {
          quiz1.classList.add('hidden');
          quiz2.classList.remove('hidden');
        }, 1000);
      }
    }

    // --- Quiz 2: 15 strings, 3 boxes ---
    // We want to check if each dragged item is in the correct box.
    const box1 = document.getElementById('box1');
    const box2 = document.getElementById('box2');
    const box3 = document.getElementById('box3');
    const stringsContainer2 = document.getElementById('stringsContainer2');

    // Create Sortable for each drop box and the container
    let quiz2Sortables = [];
    [box1, box2, box3, stringsContainer2].forEach(el => {
      quiz2Sortables.push(
        new Sortable(el, {
          group: 'quiz2',
          animation: 150,
          onSort: function () {
            checkQuiz2();
          }
        })
      );
    });

    function checkQuiz2() {
      // Check all child .draggable in each box
      let allCorrect = true;

      // Each box has data-box = "1", "2", or "3"
      [box1, box2, box3].forEach(box => {
        const boxNum = box.dataset.box; 
        const children = box.querySelectorAll('.draggable');
        children.forEach(child => {
          if (child.dataset.correctBox !== boxNum) {
            allCorrect = false;
          }
        });
      });
      // Also check that no item that belongs in box 1,2,3 got left behind in stringsContainer2
      // If you require that all must be moved out of the container to pass, we can check that too:
      // but that's optional based on your preference.

      if (allCorrect) {
        ding.play();
        setTimeout(() => {
          quiz2.classList.add('hidden');
          quiz3.classList.remove('hidden');
        }, 1000);
      }
    }

    // --- Quiz 3: 16 strings, 2 boxes ---
    const box4 = document.getElementById('box4');
    const box5 = document.getElementById('box5');
    const stringsContainer3 = document.getElementById('stringsContainer3');

    let quiz3Sortables = [];
    [box4, box5, stringsContainer3].forEach(el => {
      quiz3Sortables.push(
        new Sortable(el, {
          group: 'quiz3',
          animation: 150,
          onSort: function () {
            checkQuiz3();
          }
        })
      );
    });

    function checkQuiz3() {
      // Similar approach: box1q3.dataset.box="1", box2q3.dataset.box="2"
      let allCorrect = true;
      [box4, box5].forEach(box => {
        const boxNum = box.dataset.box;
        const children = box.querySelectorAll('.draggable');
        children.forEach(child => {
          if (child.dataset.correctBox !== boxNum) {
            allCorrect = false;
          }
        });
      });

      if (allCorrect) {
        tada.play();
        setTimeout(() => {
          // Redirect to congrats page
          window.location.href = 'congrats.html';
        }, 1000);
      }
    }

    // Utility to compare arrays
    function arraysMatch(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }
  </script>
</body>
</html>
